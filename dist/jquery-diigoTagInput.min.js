/*!
* name: jquery-diigoTagInput
* version: 1.0.0 - 2013-07-28
* Homepage: luokebi.github.io
* Repository: https://github.com/luokebi/diigoTagInput.git
* Copyright (c) 2013 luo
* Licensed  
*/
(function(t){function e(t){return t.find(".diigo_tag:last")}function a(t){return""!==t.val()?!0:!1}function i(e,a,i){var n=t.inArray(e,i);return i[n]=a,i}function n(t){e(t).addClass("remove")}var r={spaceKey:!1,placeHolderText:null,removeComfirmation:!0,editable:!0,tagSource:null,enterKey:!1},o={init:function(i){return console.log(i),this.each(function(){var s=t(this),d=t(this).data("diigoTagOption");d===void 0&&(d=t.extend({},r,i||{}),s.data("diigoTagOption",JSON.stringify(d)));var l=[];s.data("diigoTags",l);var c=s.wrap('<div class="diigo-tag-input-wrapper"></div>').addClass("diigo-tag-input").attr("placeholder","Input or select tags"),u=s.parent();c.on("keyup",function(i){var r=t(this),l=a(r);if(13===i.which)d.enterKey===!0&&l&&o.createTag(r.val(),s);else if(32===i.which)if(l){if(d.spaceKey===!0)if(i.preventDefault(),0!==r.val().indexOf("'")&&0!==r.val().indexOf('"'))o.createTag(r.val(),s);else if(/^(\'|").*(\'|")\s$/.test(r.val())){var c=r.val().match(/^(\'|")(.*)(\'|")\s$/),g=c[2];o.createTag(g,s)}}else i.preventDefault();else if(8===i.which){var f=e(u),h=d.removeComfirmation;l||(!h||f.hasClass("remove")?o.removeTag(f,s):h&&!f.hasClass("remove")&&n(u))}else e(u).removeClass("remove")}).on("blur",function(){""!==t(this).val()&&o.createTag(t(this).val(),s)}),d.placeHolderText&&c.on("focus",function(){t(this).attr("placeholder",d.placeHolderText)}).on("blur",function(){t(this).attr("placeholder","Input or select tags")})})},createTag:function(e,a){a||(a=t(this));var n=a,r=n.parent(),s=a.data("diigoTags"),d=a.data("diigoTagOption");if(e=t.trim(e),-1!==t.inArray(e,s))return r.find(".diigo_tag").each(function(){if(console.log(t(this).data("content"),e),t(this).data("content")===e){t(this).addClass("repeated");var a=t(this);setTimeout(function(){a.removeClass("repeated")},1200)}}),void 0;var l=t('<div class="diigo_tag"><span>'+e+"</span></div>").data("content",e);return t("<div></div>").addClass("diigo_tag_close").appendTo(l).on("click",function(t){t.preventDefault(),o.removeTag(l,a)}),l.insertBefore(n),d.editable&&l.find("span").attr("contenteditable","true").on("click",function(){t(this).parent().addClass("edit")}).on("blur",function(){t(this).parent().removeClass("edit"),""===t(this).text()?o.removeTag(t(this).parent()):(s=i(t(this).parent().data("content"),t(this).text(),s),a.data("diigoTags",s),t(this).data("content",t(this).text()))}).on("keydown",function(e){13===e.which?t(this).blur():8===e.which&&""===t(this).text()&&o.removeTag(t(this).parent())}),n.val(""),s.push(e),a.data("diigoTags",s),a},removeTag:function(e,a){a||(a=t(this));var i=a.data("diigoTags"),n=a;return e.fadeOut(100,function(){var e=t(this).find("span").text(),r=t.inArray(e,i);i.splice(r,1),a.data("diigoTags",i),t(this).remove(),n.focus()}),a},getAllTags:function(){return t(this).data("diigoTags")}};t.fn.diigoTagInput=function(){var e=arguments[0],a=arguments;if(o[e])e=o[e],a=Array.prototype.slice.call(arguments,1),a.shift();else{if("object"!=typeof e&&e)return t.error("Method "+e+" does not exist on jQuery.diigoTagInput"),this;e=o.init}return e.apply(this,a)}})(jQuery);